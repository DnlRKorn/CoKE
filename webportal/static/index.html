<html>
<head>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<style>
.green_dot {
  height: 25px;
  width: 25px;
  background-color: #0b0;
  border-radius: 50%;
  display: inline-block;
}
.yellow_dot {
  height: 25px;
  width: 25px;
  background-color: #FFFC33;
  border-radius: 50%;
  display: inline-block;
}
.orange_dot {
  height: 25px;
  width: 25px;
  background-color: #FB8216;
  border-radius: 50%;
  display: inline-block;
}
.red_dot {
  height: 25px;
  width: 25px;
  background-color: #b00;
  border-radius: 50%;
  display: inline-block;
}
</style>
</head>
<body>
COVID Text
<form id="login_form" >
  <label for="fname">Idx:</label>
  <input type="text" id="fname" name="fname" value="CVPROT#P0DTD1"><br><br>
  <input type="checkbox" id="dtd" name="dtd" value="True">
  <label for="dtd"> Drug-Target-Disease</label><br>
  <input type="submit" value="Submit">
</form>
<table class="table-bordered" >
	<tr>
		<th>Term1</th>
		<th>Term2</th>
		<th>Overlap</th>
		<th>Rank</th>
	</tr>
	<tbody id="tbl">
	</tbody>

</table>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
	      <table id="modalTable">
	      </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
</body>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script>  
$('#login_form').on('submit', function(e) { //use on if jQuery 1.7+
  e.preventDefault();  //prevent form from submitting
  var data = $("#login_form :input").serializeArray();
  var term = data[0]["value"];
  var dtd = "False";
  if(data.length==2){
	  dtd="True";
  }

  $.ajax({url: "/search",
	  type: "get",
	  data: {term:term,dtd:dtd},
	  //data: {term:"CVPROT#P0DTD1"},
	  success: function(result){
		  $("#tbl").empty();
		  for (var i = 0; i < result.length; i++) {
			  var l = [result[i][0],result[i][1]];
		          l.push('<a href="#" row_num='+i+' class="overlap_link">'+result[i][2]+'</a>');
			  switch(result[i][3]){
				  case 0:
			             l.push('<span class="green_dot"></span>');
				  case 1:
			             l.push('<span class="yellow_dot"></span>');
				  case 2:
			             l.push('<span class="orange_dot"></span>');
				  case 3:
			             l.push('<span class="red_dot"></span>');

			  }
			  for(var j=0;j<4;j++){
				  l[j]="<td>"+l[j] + "</td>";
			  }

			  //$("#tbl").append('<tr><td>'+result[i][0]+'</td><td>'+result[i][1]+'</td><td><a href="#" row_num='+i+' class="overlap_link">'+result[i][2]+'</a></td></tr>');
			  $("#tbl").append('<tr>'+l.join("")+'</tr>');
		  }
		  console.log(result);
          }
  });
console.log(data); //use the console for debugging, F12 in Chrome, not alerts
});

$('.overlap_link a').click(function(evt) {

    evt.preventDefault();
    //alert('here in');
    var divId = 'summary' + this.id.substring(0, this.id.length-1);

    document.getElementById(divId).className = ''; 

});

$(document).on('click', '.overlap_link', function() { 
	//alert("hello"); 
	//var row_num = parseInt($(this)[0].getAttribute("row_num")) + 1;
	var row_num = parseInt($(this)[0].getAttribute("row_num"));
	//var row =  $('.tbl tr:eq('+row_num+')');
	var row = $('#tbl tr:eq('+row_num+')')
	var term1 = $(row[0]).find("td")[0].textContent
	var term2 = $(row[0]).find("td")[1].textContent


	$("#modalTable").empty();
        $.ajax({url: "/getPapers",
	     type: "get",
	     //data: {term:data["fname"]},
	     data: {term1:term1,term2:term2},
	     success: function(result){
		     for (var i=0; i< result.length; i++){
	//http://35.196.80.123/highlight?paper=453985e02d2419abce4d5626b093a888187cfc7a&term1=CVPROT%23P0DTD1&term2=DRUG%23CHEMBL296588
			     var link = "/highlight?paper=" + result[i] + "&term1=" + encodeURIComponent(term1) + "&term2=" + encodeURIComponent(term2);
			     $("#modalTable").append('<tr><td><a href="'+link+'">'+result[i]+'</a></td></tr>');


		     }
		     console.log(result);
	             $('#myModal').modal('show');
	     }
	});

});
</script>
</html>
